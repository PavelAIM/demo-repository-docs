# Глава 2. Расширяйте и автоматизируйте OpenWebUI через AI-чат

Эта глава объясняет, как превратить встроенный чат OpenWebUI в «Эксперта по OpenWebUI» и использовать его для безопасной автоматизации повседневных задач администрирования.

---

## Содержание

2.1  Зачем учить ИИ контексту  
2.2  От «голой» модели до «Эксперта»  
2.3  Пошаговое создание модели-эксперта  
  2.3.1  Чек-лист: требования ⇆ формулировки  
  2.3.2  Итоговый системный промпт  
2.4  Практика 1: настройка системного времени  
2.5  Практика 2: человекопонятный домен + HTTPS  
2.6  Практика 3: скрипт «Типичная корп-инсталляция»  
2.7  Шпаргалка по prompt-engineering  
2.8  Troubleshooting  
2.9  Что дальше  

---

## 2.1 Зачем учить ИИ контексту

Без контекста модель отвечает «в среднем по больнице».  
Добавив системный промпт с правилами и данными о вашей установке, вы:

* получаете точные, проверяемые ответы;  
* экономите время на уточнениях;  
* повторно используете готовую роль для любых проектов.

> **Рис. 2-1** (expert-vs-pure-model.png):  
> Сравнение ответов «сырой» модели и модели-эксперта. Справа — правильный, полный и понятный результат.


> **Кратко о контекстной инженерии**  
> Сильная модель не спасёт, если она не получила нужные данные. Контекстная инженерия — это системное управление тем, *какую* информацию, *в каком* формате и *с какими* инструментами мы передаём LLM.  
> • Хороший поиск / подбор контента вытянет даже слабую модель; плохой поиск «убьёт» и GPT-4.  
> • Система должна:  
>   1) динамично собирать данные из запросов, истории, внешних источников;  
>   2) подключать нужные инструменты (API, БД) и отдавать ответы в удобном виде;  
>   3) хранить краткую и долгую «память»;  
>   4) держать контекст коротким и информативным.  
> Пока модели улучшаются, именно качество контекста остаётся главным узким горлом — поэтому мы уделяем ему столько внимания в этой главе.

---

## 2.2 От «голой» модели до «Эксперта»

Алгоритм:

1. Выберите базовую модель (gpt-4o, Claude, Llama 3 8B и т.д.).  
2. Создайте «обёртку»-модель в Workspace → Models.  
3. Заполните системный промпт (см. разд. 2.3).  
4. Сохраните: Эксперт готов к работе.

> **Рис. 2-2** (import-models-from-json-small.png):  
> Опционально можно импортировать готовый JSON `openwebui-expert-model.json`.

---

## 2.3 Пошаговое создание модели-эксперта

1. Откройте меню: **Workspace → Models → New Model (+).**  
2. Заполните поля (см. рис. 2-3):  
   * **Name:** `Эксперт по OpenWebUI`  
   * **Base model:** `gpt-4o`  
   * **Description:** `Настройка и автоматизация OpenWebUI`  
3. Скопируйте системный промпт из разд. 2.3.2.  
4. Нажмите **Save**.

> **Рис. 2-3** (create-new-model.png):  
> Создание новой модели-эксперта.

### 2.3.1 Чек-лист: что хотим ⇆ как просим

| Что мы хотим от ответа | Формулировка в промпте |
|------------------------|------------------------|
| 1. Безопасность и проверка фактов | «Всегда проверяй решения на безопасность и актуальность, ссылайся только на официальную документацию. Не выдумывай факты.» |
| 2. Полнота, все шаги | «Дай полный, пошаговый ответ; если данных мало — сначала задай уточняющие вопросы.» |
| 3. Надёжность, ссылки, версии | «Приводи номера версий и ссылки на источники; не отвечай, если нет достоверной информации.» |
| 4. Чёткая структура | «Используй формат: === Резюме ===, === Скрипт ===, === Тестирование ===, === Объяснение ===, === Предупреждения ===.» |
| 5. Готовый скрипт | «Если задачу можно автоматизировать — сначала выдай рабочий bash-скрипт, затем поясни.» |
| 6. Шаги тестирования и отката | «После скрипта опиши, как проверить результат и как откатить изменения.» |
| 7. Предупреждения о рисках | «Добавь раздел ‘Предупреждения’: перечисли риски и способы их избежать.» |
| 8. Дружелюбный, мотивирующий тон | «Пиши кратко и дружелюбно; добавляй эмодзи для ключевых шагов, без воды.» |
| 9. Итеративность | «Если входных данных недостаточно, сперва попроси уточнения.» |
|10. Никаких радикальных действий | «Не предлагай переустанавливать всё с нуля; работай поверх текущей конфигурации.» |

**Как пользоваться**  
1) Отметьте нужные строки.  
2) Вставьте формулировки в системный или пользовательский промпт.  
3) При желании меняйте порядок — требования главное, а не их позиция.

### 2.3.2 Итоговый системный промпт

```text
Ты — ассистент по настройке OpenWebUI и эксперт по Bash, Docker, DevOps.
Опирайся только на официальную документацию; не выдумывай факты.
Всегда проверяй решения на безопасность и актуальность, ссылайся
на документы и версии. Если данных мало — уточни вопросы.

Формат ответа:
=== Резюме ===
=== Скрипт ===
=== Тестирование ===
=== Объяснение ===
=== Предупреждения ===

Если задачу можно автоматизировать — сначала выдай рабочий bash-скрипт,
затем поясни. После скрипта опиши тестирование и откат. Добавь
‘Предупреждения’ с рисками и мерами. Пиши кратко и дружелюбно, добавляй
эмодзи для ключевых шагов. Не предлагай переустанавливать всё с нуля;
работай поверх текущей конфигурации. Контекст: OpenWebUI уже установлен
на Ubuntu 22.04 по <инструкция-часть 1>.
```

---

## 2.4 Практика 1: настройка системного времени

**Цель:** корректное время в контейнере и в логах OpenWebUI.

**Шаги в чате**

```text
Сгенерируй скрипт для синхронизации времени через systemd-timesyncd
на Ubuntu 22.04. Покажи, как проверить результат.
```

**Ожидаемый ответ Эксперта**  

```text
=== Резюме ===
Настраиваем NTP через systemd-timesyncd.

=== Скрипт ===
sudo timedatectl set-timezone Europe/Moscow
sudo apt update && sudo apt install -y systemd-timesyncd
sudo systemctl enable --now systemd-timesyncd

=== Тестирование ===
1. timedatectl status   # NTP synchronized: yes
2. journalctl -u systemd-timesyncd | tail

=== Объяснение ===
...

=== Предупреждения ===
Смена тайм-зоны влияет на логи и планировщики cron.
```

Проверьте `timedatectl status`. При ошибке — см. разд. 2.8.

---

## 2.5 Практика 2: человекопонятный домен + HTTPS

**Задача:** заменить `http://10.0.0.15:8080` на `https://ai.example.com`.

1. Зарегистрируйте поддомен `ai.example.com`.  
2. Спросите Эксперта:

```text
Сгенерируй docker-compose с Caddy, который:
• проксирует ai.example.com → OpenWebUI:8080;
• выпускает/обновляет Let’s Encrypt TLS;
• пишет логи в ./logs.
```

3. Сохраните YAML, выполните `docker compose up -d`.  

> **Рис. 2-4** (caddy-openwebui.png):  
> Caddy + OpenWebUI с автоматическим TLS.

---

## 2.6 Практика 3: скрипт «Типичная корп-инсталляция»

Поручите Эксперту собрать единый `install_corp_openwebui.sh`, который:

* проверяет Docker/Compose;  
* развёртывает OpenWebUI + PostgreSQL;  
* создаёт том для моделей;  
* настраивает ежедневный бэкап (cron);  
* шлёт оповещения в Slack при падении контейнера.

**Шаблон запроса**

```text
Сгенерируй idempotent-скрипт install_corp_openwebui.sh для Ubuntu 22.04,
который выполняет пункты 1–5. Запрети sudo без пароля.
Добавь тестирование и предупреждения.
```

---

## 2.7 Шпаргалка по prompt-engineering

* **Конкретика**: «Добавь OAuth 2.0 через GitLab» вместо «Сделай логин».  
* **Роль**: «Ты — DevOps-инженер…».  
* **Контекст**: текущий `docker-compose.yml`.  
* **Структура**: просите формат из разд. 2.3.1.  
* **Итеративность**: «Если данных мало — уточни».  
* **Валидация**: запускайте с `--dry-run` или в VM.  
* **Источники**: «Укажи ссылки и версии».  
* **UX**: эмодзи и мотивация, если нужно вовлечение.

---

## 2.8 Troubleshooting

| Симптом | Возможная причина | Решение |
|---------|------------------|---------|
| Модель игнорирует формат | Промпт обрезан из-за лимита токенов | Сократите контекст, оставьте ключевые правила |
| `permission denied` при запуске скрипта | Нет sudo/прав | Добавьте `sudo`, настройте `NOPASSWD`, используйте root-контейнер |
| Caddy не получает сертификат | Порты 80/443 закрыты; неправильная A-запись | Откройте порты, проверьте DNS: `dig ai.example.com` |

---

## 2.9 Что дальше

Вы научились:

✓ задавать системный промпт,  
✓ генерировать рабочие скрипты,  
✓ безопасно расширять конфигурацию.

В следующей главе разберём подключение дополнительных языковых моделей (Llama 3 8B, Mistral 7B) и распределение нагрузки между GPU-серверами.

Удачной автоматизации! 🚀